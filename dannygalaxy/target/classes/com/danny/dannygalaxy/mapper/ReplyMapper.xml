<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.danny.dannygalaxy.mapper.ReplyMapper">

	<!-- 특정 게시물에 대한 댓글 목록 조회  -->
	<select id="selectMyReplyList" resultType="com.danny.dannygalaxy.domain.MyReplyVO">
        <![CDATA[
	        SELECT rno, rcontent, rwriter,rregdate, rmoddate, prno, bno, rdelFlag, LEVEL AS lvl
			FROM (SELECT /*+ INDEX_ASC(tbl_myreply IDX_MYREPLY_BNO_RNO) */ *
		    	   FROM schatz.tbl_myreply
			      WHERE bno = #{bno})
			START WITH prno IS NULL
			CONNECT BY PRIOR rno = prno
        ]]>	
	</select>
	
	<!-- 특정 게시물에 대한 댓글 등록 -->
	<insert id="insertMyReplyForBoard">
	    <selectKey keyProperty="rno" order="BEFORE" resultType="long">
	    	SELECT schatz.seq_myreply.NEXTVAL FROM dual
	    </selectKey>
	    INSERT INTO schatz.tbl_myreply
	    VALUES(#{bno},#{rno},#{rcontent},#{rwriter},DEFAULT,DEFAULT,DEFAULT,DEFAULT)
	</insert>	
	
	<!-- 댓글에 대한 답글 등록 -->
	<insert id="insertMyReplyForReply">
		<selectKey keyProperty="rno" order="BEFORE" resultType="long">
			SELECT schatz.seq_myreply.NEXTVAL FROM dual
		</selectKey>
		INSERT INTO schatz.tbl_myreply
	    VALUES(#{bno},#{rno},#{rcontent},#{rwriter},DEFAULT,DEFAULT,#{prno},DEFAULT)
	</insert>
	
	<!-- 특정 게시물에 대한 특정 댓글/답글 조회 -->  
	<select id="selectMyReply" resultType="com.danny.dannygalaxy.domain.MyReplyVO">
		SELECT bno,rno,rcontent,rwriter,rregdate,rmoddate,prno,rdelflag
		  FROM schatz.tbl_myreply
		 WHERE bno = #{bno} AND rno =#{rno}
	</select>
  
    <!-- 특정 게시물에 대한 댓글/답글 수정 -->
  		<update id="updateMyReply">
  			UPDATE schatz.tbl_myreply
  			   SET rcontent = #{rcontent},
  			       rmodDate = default
  			 WHERE bno =#{bno} AND rno =#{rno}
  		
  		</update>  
     
     <!-- 특정 게시물에 대한 댓글/답글 삭제 -->
  		<delete id="deleteMyReply">
  			DELETE FROM schatz.tbl_myreply
  			 WHERE bno = #{bno} AND rno = #{rno}
  		</delete>  
    
    <!-- 특정 게시물에 대한 댓글/답글 삭제요청-->
  		<update id="updateBdelFlagMyReply">
  			UPDATE schatz.tbl_myreply
  			   SET rdelFlag = 1,
  			       rmodDate = default
		     WHERE bno = #{bno} AND rno=#{rno}	       		
  		</update>  
  		
  		<!-- 특정 게시물에 대한 모든 댓글 삭제 -->
  		<delete id="deleteAllReply">
  			DELETE FROM schatz.tbl_myreply
  			 WHERE bno =#{bno}
  		</delete>		
  		
     <!-- 특정 게시물에 대한 모든 댓글/답글 삭제요청-->
       <update id="updateBdelFlagAllReply">
  			UPDATE schatz.tbl_myreply
  			   SET rdelFlag = 1,
  			       rmodDate = default
		    WHERE  bno = #{bno}    
       </update>  
  
  </mapper>